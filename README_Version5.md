# Platinum Store Pro — إعداد للنشر (مُحدَّث)

هذا الدليل يشرح كيفية تشغيل المشروع محليًا وتهيئته للنشر، بعد دمج الملفات من الأرشيفين كـ مشروع واحد.

ملاحظات مهمة قبل البدء
- لا ترفع مفتاح Gemini API إلى مستودع عام.
- يمكن حقن المفتاح عبر:
  - إضافة `<meta name="gemini-api-key" content="YOUR_KEY">` في `index.html` قبل البناء/النشر، أو
  - إعداد متغيّر بيئة `GEMINI_API_KEY` في بيئة البناء/الخادم، أو
  - حقن كائن window.__PLATINUM__.GEMINI_API_KEY عند تحميل الصفحة من خادمك.

خطوات تشغيل محلي
1. افحص المشروع بعد الدمج: تأكد أن مسار الملفات هو `src/...` ويحتوي على الملفات الموحّدة (خاصة `src/services/gemini.service.ts`).
2. تثبيت الحزم:
   ```
   npm install
   ```
3. إضافة مفتاح Gemini مؤقتًا (مكان آمن محليًا):
   - افتح `.env.local` وضع:
     ```
     GEMINI_API_KEY=your_real_key_here
     ```
   - أو ضع المفتاح في `<meta name="gemini-api-key" content="...">` داخل `index.html` (خيار مؤقت فقط).
4. تشغيل بيئة التطوير:
   ```
   npm run dev
   ```
   ثم افتح `http://localhost:3000` أو الـ URL المبيّن بالكونسول.

بناء للإنتاج
```
npm run build
```
ستجد الناتج في مجلد `dist/` بحسب إعداد `angular.json`.

خطوات الدمج اليدوي للأرشيفين
1. فك الضغط عن الأرشيفين في مجلدين مؤقتين.
2. اختَر ملف/إصدار لكل مسار رئيسي:
   - استخدم ملفات `src/components/*`, `src/services/*`, `src/models.ts` الأحدث والأكمل (راجع تغييرات: عرض Showcase، AI Assistant، edit/videos).
   - عند وجود تكرار، احتفظ بالنسخة التي تحتوي على مزايا أكثر واستبدل الرجل القديم.
3. احذف الملفات المكررة أو غيّر مساراتها لتجنّب الالتباس.
4. ضع الملف الموحّد `src/services/gemini.service.ts` (الموجود هنا).
5. تأكد من أن `package.json` يحتوي الاعتمادات الضرورية (`@google/genai`, `@angular/*`, `rxjs`, إلخ).

اختبارات وفحوصات سريعة بعد الدمج
- تحقق من وجود ملف واحد فقط: `src/services/gemini.service.ts` (بدون نسخ أخرى بنفس المسار).
- شغّل `npm run dev` وتحقق من عدم وجود أخطاء TypeScript في الطرفية.
- جرب:
  - فتح واجهة المتجر (store) وإضافة منتج للسلة.
  - فتح لوحة الإدارة (admin) بعد تسجيل الدخول التجريبي لاختبار الملء (password = `google$5`).
  - في لوحة الإدارة جرّب المساعد الذكي (إن كان المفتاح مضافًا) لتوليد منتج عبر الصورة.
  - تحقق من زر Showcase وميزات العرض.

أخطاء شائعة وحلول سريعة
- "Gemini API key is not configured": تأكد من وضع المفتاح في meta أو .env.local أو window.
- أخطاء CORS عند استخدام webhooks: تأكد أن عنوان webhook يقبل POST من منشئ الموقع أو استخدم خادم وسيط.
- صور لا تُعرض لأن URL محجوز (referrer): بعض الصور تتطلب header `referrerpolicy`. في حال رفض العرض، استبدل الصورة بمصدر عام (picsum / unsplash) أو استخدم dataURL.

نهايةً
- بعد تنفيذ الخطوات أعلاه سيصبح الموقع موحَّدًا وقابلاً للتشغيل محليًا والبناء للإنتاج.
- إن أردت أستطيع تنفيذ الدمج فعليًا (إن أعطيتني إذن لتحرير الملفات هنا أو في المستودع)، أو أقدّم لك مجموعة من أوامر git لتطبيق الدمج خطوة بخطوة.
